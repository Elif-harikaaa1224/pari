<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–∞—Ä–∫–µ—Ç—ã - PariVision</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <nav>
        <div class="container">
            <h1>üéØ PariVision</h1>
            <div class="nav-links">
                <a href="/">–ì–ª–∞–≤–Ω–∞—è</a>
                <a href="/bridge">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</a>
                <a href="/markets">–ú–∞—Ä–∫–µ—Ç—ã</a>
                <a href="/my-bets">–ú–æ–∏ —Å—Ç–∞–≤–∫–∏</a>
            </div>
            <div id="walletDisplay" class="wallet-display">–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ</div>
        </div>
    </nav>

    <main class="container">
        <h2>–î–æ—Å—Ç—É–ø–Ω—ã–µ –º–∞—Ä–∫–µ—Ç—ã</h2>
        <p>–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–±—ã—Ç–∏–µ –∏ —Å–¥–µ–ª–∞–π—Ç–µ —Å—Ç–∞–≤–∫—É</p>

        <div class="balance-info">
            <span>–ë–∞–ª–∞–Ω—Å –¥–ª—è —Å—Ç–∞–≤–æ–∫: <strong id="bettingBalance">-</strong> USDC</span>
            <span style="margin-left: 2rem;">–¶–µ–Ω–∞ BNB: <strong class="bnb-price">-</strong></span>
            <button onclick="manageProxyAddress()" class="btn-secondary" style="margin-left: 2rem; padding: 0.3rem 0.8rem; font-size: 0.85rem;">‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Proxy</button>
        </div>

        <div id="marketsLoading" class="loading-state">
            <div class="loading">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ –º–∞—Ä–∫–µ—Ç–æ–≤...</div>
        </div>

        <div id="marketsList" class="markets-grid"></div>
    </main>

    <!-- Betting Modal -->
    <div id="bettingModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="document.getElementById('bettingModal').style.display='none'">&times;</span>
            <h3 id="modalTitle">–°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É</h3>
            <div id="modalBody">
                <div class="bet-info">
                    <p><strong>–°–æ–±—ã—Ç–∏–µ:</strong> <span id="betMarketTitle"></span></p>
                    <p><strong>–ò—Å—Ö–æ–¥:</strong> <span id="betOutcome"></span></p>
                    <p><strong>–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç:</strong> <span id="betOdds">-</span></p>
                    <p style="background: #e3f2fd; padding: 8px; border-radius: 5px; margin-top: 10px;">
                        <strong>üîë –í–∞—à Proxy Wallet:</strong><br>
                        <code style="font-size: 11px; word-break: break-all;" id="userProxyAddress">-</code>
                    </p>
                    <div style="background: #fff3cd; padding: 10px; border-radius: 5px; margin-top: 10px; font-size: 13px;">
                        ‚ÑπÔ∏è <strong>–í–∞–∂–Ω–æ:</strong> USDC –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞ –≤–∞—à–µ–º <strong>Proxy –∞–¥—Ä–µ—Å–µ</strong> –≤—ã—à–µ, –∞ –Ω–µ –Ω–∞ –æ–±—ã—á–Ω–æ–º –∫–æ—à–µ–ª—å–∫–µ!
                    </div>
                </div>
                <div class="input-group">
                    <label>–°—É–º–º–∞ —Å—Ç–∞–≤–∫–∏ (BNB):</label>
                    <input type="number" id="betAmountBNB" placeholder="0.1" min="0.01" step="0.01">
                    <small>‚âà <span id="betAmountUSDC">0</span> USDC</small>
                </div>
                <div class="bet-estimate">
                    <p>–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à: <strong id="betPayout">-</strong> USDC</p>
                </div>
                <div style="background: #f0f0f0; padding: 10px; border-radius: 5px; margin: 10px 0; font-size: 12px;">
                    <strong>üí° –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Bridge:</strong><br>
                    1Ô∏è‚É£ BNB –æ–±–º–µ–Ω–∏–≤–∞–µ—Ç—Å—è –Ω–∞ USDT —á–µ—Ä–µ–∑ PancakeSwap (BSC)<br>
                    2Ô∏è‚É£ USDT –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ Stargate Bridge –Ω–∞ Polygon<br>
                    3Ô∏è‚É£ –ù–∞ Polygon –ø–æ–ª—É—á–∞–µ—Ç–µ USDC –Ω–∞ –≤–∞—à Proxy –∞–¥—Ä–µ—Å<br>
                    4Ô∏è‚É£ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–º–µ—â–∞–µ—Ç—Å—è —Å—Ç–∞–≤–∫–∞ —á–µ—Ä–µ–∑ –ø–æ–¥–ø–∏—Å—å<br><br>
                    ‚è±Ô∏è –í–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–Ω–∏–º–∞–µ—Ç ~5-15 –º–∏–Ω—É—Ç
                </div>
                <button id="placeBetBtn" class="btn btn-primary">–†–∞–∑–º–µ—Å—Ç–∏—Ç—å —Å—Ç–∞–≤–∫—É</button>
                <div id="betStatus" class="status"></div>
            </div>
        </div>
    </div>

    <!-- Bridge Modal -->
    <div id="bridgeModal" class="modal">
        <div class="modal-content">
            <h3>üåâ –û—Ç–ø—Ä–∞–≤–∫–∞ —Å—Ä–µ–¥—Å—Ç–≤ —á–µ—Ä–µ–∑ Bridge</h3>
            <div id="bridgeBody">
                <div class="bridge-info">
                    <p><strong>–°—É–º–º–∞ BNB:</strong> <span id="bridgeBNBAmount">-</span></p>
                    <p><strong>–ü–æ–ª—É—á–∏—Ç–µ USDC:</strong> <span id="bridgeUSDCAmount">-</span></p>
                    <p><strong>–ù–∞ –∞–¥—Ä–µ—Å (Proxy):</strong> <span id="bridgeToAddress">-</span></p>
                </div>
                <div id="bridgeStatus" class="status"></div>
                <div class="bridge-steps">
                    <div class="step" id="step1">
                        <span class="step-icon">1</span>
                        <span class="step-text">–†–∞—Å—á–µ—Ç —Å—É–º–º—ã</span>
                        <span class="step-status" id="step1Status">‚è≥</span>
                    </div>
                    <div class="step" id="step2">
                        <span class="step-icon">2</span>
                        <span class="step-text">Swap BNB ‚Üí USDT (PancakeSwap)</span>
                        <span class="step-status" id="step2Status">‚è≥</span>
                    </div>
                    <div class="step" id="step3">
                        <span class="step-icon">3</span>
                        <span class="step-text">Bridge USDT ‚Üí USDC (Stargate BSC‚ÜíPolygon)</span>
                        <span class="step-status" id="step3Status">‚è≥</span>
                    </div>
                    <div class="step" id="step4">
                        <span class="step-icon">4</span>
                        <span class="step-text">–ü–æ–ª—É—á–µ–Ω–∏–µ USDC –Ω–∞ Polygon</span>
                        <span class="step-status" id="step4Status">‚è≥</span>
                    </div>
                    <div class="step" id="step5">
                        <span class="step-icon">5</span>
                        <span class="step-text">–†–∞–∑–º–µ—â–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–∏ –Ω–∞ Polymarket</span>
                        <span class="step-status" id="step5Status">‚è≥</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Load Ethers.js from local node_modules -->
    <script src="/libs/ethers/dist/ethers.umd.min.js"></script>
    <script>
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ethers
        if (typeof ethers === 'undefined') {
            console.error('‚ùå Ethers.js failed to load!');
            alert('–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ ethers.js –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
        } else {
            console.log('‚úì Ethers.js loaded successfully', ethers.version);
        }
    </script>
    
    <script src="/js/config.js"></script>
    <script src="/js/bnb-price-tracker.js"></script>
    <script src="/js/wallet.js"></script>
    <script src="/js/proxy-wallet.js"></script>
    <script src="/js/stargate-bridge.js"></script>
    <script src="/js/polymarket-order.js"></script>
    <script src="/js/markets.js"></script>
    <script>
        window.addEventListener('load', async () => {
            await initWallet();
            await initMarkets();
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è proxy
            const manageProxyBtn = document.getElementById('manageProxyBtn');
            if (manageProxyBtn) {
                manageProxyBtn.addEventListener('click', manageProxyAddress);
            }
        });
    </script>
</body>
</html>