<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - PariVision</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1a1a1a;
            color: #00ff00;
        }
        .test { margin: 10px 0; padding: 10px; background: #2a2a2a; border-left: 3px solid #00ff00; }
        .error { border-left-color: #ff0000; color: #ff0000; }
        .success { border-left-color: #00ff00; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        pre { background: #000; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üß™ PariVision API Test</h1>
    
    <div>
        <button onclick="testConfig()">Test Config API</button>
        <button onclick="testMarkets()">Test Markets API</button>
        <button onclick="testPolymarketDirect()">Test Polymarket Direct</button>
        <button onclick="testEthers()">Test Ethers.js</button>
    </div>

    <div id="results"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <script>
        function log(message, isError = false) {
            const div = document.createElement('div');
            div.className = 'test ' + (isError ? 'error' : 'success');
            div.innerHTML = message;
            document.getElementById('results').appendChild(div);
        }

        async function testConfig() {
            log('Testing /api/config...');
            try {
                const response = await fetch('/api/config');
                const data = await response.json();
                log('‚úÖ Config loaded successfully');
                log('<pre>' + JSON.stringify(data, null, 2) + '</pre>');
            } catch (error) {
                log('‚ùå Config failed: ' + error.message, true);
            }
        }

        async function testMarkets() {
            log('Testing /api/markets...');
            try {
                const response = await fetch('/api/markets');
                const data = await response.json();
                
                if (data.success) {
                    log('‚úÖ Markets loaded: ' + data.data.length + ' markets');
                    log('<pre>' + JSON.stringify(data.data[0], null, 2) + '</pre>');
                } else {
                    log('‚ùå Markets API returned error: ' + data.error, true);
                }
            } catch (error) {
                log('‚ùå Markets failed: ' + error.message, true);
            }
        }

        async function testPolymarketDirect() {
            log('Testing Polymarket API directly...');
            try {
                const response = await fetch('https://gamma-api.polymarket.com/markets?limit=5&closed=false');
                const data = await response.json();
                log('‚úÖ Direct Polymarket API works! Markets: ' + data.length);
                log('<pre>' + JSON.stringify(data[0], null, 2) + '</pre>');
            } catch (error) {
                log('‚ùå Direct API failed: ' + error.message, true);
            }
        }

        function testEthers() {
            log('Testing Ethers.js...');
            if (typeof ethers === 'undefined') {
                log('‚ùå Ethers.js not loaded!', true);
            } else {
                log('‚úÖ Ethers.js loaded: ' + ethers.version);
                log('Testing address validation...');
                const testAddr = '0x871046Dd7808147DE9640619Ab974F09A7922548';
                const isValid = ethers.utils.isAddress(testAddr);
                log('Address ' + testAddr + ' is ' + (isValid ? 'valid ‚úÖ' : 'invalid ‚ùå'));
            }
        }

        // Auto-run tests
        window.addEventListener('load', () => {
            log('üöÄ Running automatic tests...');
            testEthers();
            setTimeout(() => testConfig(), 500);
            setTimeout(() => testMarkets(), 1000);
            setTimeout(() => testPolymarketDirect(), 1500);
        });
    </script>
</body>
</html>